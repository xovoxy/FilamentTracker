# 数据迁移功能说明

## 功能概述

数据迁移功能允许用户在不同设备之间迁移所有应用数据，包括：

- ✅ 所有耗材数据（包括已归档的）
- ✅ 每个耗材的使用记录（UsageLog）
- ✅ 材料颜色配置（MaterialColorConfig）
- ✅ 应用设置（AppSettings）

## 如何访问

1. 打开应用
2. 点击右上角的设置图标
3. 选择"数据迁移"

## 导出数据

### 步骤：
1. 在数据迁移页面点击"导出到 JSON"按钮
2. 选择保存位置
3. JSON文件将以 `FilamentTracker_Export_YYYY-MM-DD_HHMMSS.json` 格式命名

### 导出内容：
导出的JSON文件包含完整的数据结构：

```json
{
  "version": "1.0",
  "exportDate": "2026-01-19T10:30:00Z",
  "filaments": [
    {
      "id": "uuid",
      "material": "PLA",
      "brand": "XYZ",
      "colorName": "Red",
      "colorHex": "#FF0000",
      "diameter": 1.75,
      "initialWeight": 1000.0,
      "remainingWeight": 850.0,
      "emptySpoolWeight": null,
      "density": null,
      "minTemp": 200,
      "maxTemp": 220,
      "bedTemp": 60,
      "price": 50,
      "purchaseDate": "2026-01-01T00:00:00Z",
      "isArchived": false,
      "notes": "备注",
      "logs": [
        {
          "id": "uuid",
          "amount": 150.0,
          "date": "2026-01-15T10:00:00Z",
          "note": "打印项目A",
          "type": "print"
        }
      ]
    }
  ],
  "materialColorConfigs": [
    {
      "material": "PLA",
      "colorHex": "#7FD4B0"
    }
  ],
  "appSettings": {
    "defaultDiameter": 1.75,
    "lowStockThreshold": 20.0,
    "currency": "¥",
    "language": "zh_Hans"
  }
}
```

## 导入数据

### 步骤：
1. 在数据迁移页面点击"从 JSON 导入"按钮
2. 选择要导入的JSON文件
3. 选择导入模式：
   - **合并导入**：保留现有数据，只添加新数据（通过UUID判断）
   - **替换导入**：清空现有数据后导入（⚠️ 谨慎使用）
4. 确认导入

### 导入模式说明：

#### 合并导入（推荐）
- 保留所有现有数据
- 只导入UUID不存在的新数据
- 如果JSON中的数据与现有数据UUID相同，则跳过
- 适合：
  - 从其他设备导入额外的耗材
  - 备份恢复时保留当前数据

#### 替换导入（谨慎使用）
- 清空所有现有数据
- 导入JSON中的所有数据
- 不可逆操作
- 适合：
  - 全新设备的完整数据恢复
  - 确定要完全替换当前数据的情况

## 使用场景

### 场景1：设备迁移
1. 在旧设备上导出所有数据
2. 将JSON文件传输到新设备（通过AirDrop、iCloud、邮件等）
3. 在新设备上使用"替换导入"模式导入数据

### 场景2：定期备份
1. 定期导出数据到安全位置
2. 如需恢复，使用"替换导入"模式

### 场景3：合并多个数据源
1. 从多个设备分别导出数据
2. 在目标设备上使用"合并导入"模式依次导入

### 场景4：数据共享
1. 导出特定耗材数据
2. 与团队成员分享
3. 对方使用"合并导入"模式添加到自己的库中

## 技术细节

### 数据完整性
- 使用UUID确保数据唯一性
- 保留所有关联关系（Filament ↔ UsageLog）
- 使用ISO8601日期格式确保跨时区兼容

### 文件格式
- 标准JSON格式
- Pretty-printed，易于阅读和调试
- UTF-8编码

### 错误处理
- 无效JSON格式会显示错误提示
- 导入失败不会影响现有数据
- 所有操作都有成功/失败反馈

## 注意事项

⚠️ **重要提示：**
1. 导出的JSON文件可能包含敏感信息（价格、备注等），请妥善保管
2. 使用"替换导入"前请确保已备份当前数据
3. 导入大量数据时可能需要一些时间，请耐心等待
4. 建议定期备份数据

## 故障排除

### Q: 导出失败怎么办？
A: 检查存储空间是否充足，尝试选择其他保存位置。

### Q: 导入时提示格式错误？
A: 确保JSON文件没有被修改或损坏，尝试重新导出。

### Q: 导入后数据不完整？
A: 检查JSON文件内容是否完整，确认选择了正确的导入模式。

### Q: 如何只导入部分数据？
A: 可以手动编辑JSON文件，删除不需要的耗材条目，然后使用"合并导入"模式。

## 版本兼容性

当前版本：1.0
- 支持所有模型的完整导入导出
- 向后兼容：旧版本导出的数据可以导入新版本
- 向前兼容：新版本会尽量保持JSON格式兼容

## 反馈与支持

如有问题或建议，请联系开发者。
